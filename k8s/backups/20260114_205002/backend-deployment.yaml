apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "44"
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{},"labels":{"app":"backend"},"name":"backend","namespace":"tenant-management"},"spec":{"replicas":1,"selector":{"matchLabels":{"app":"backend"}},"template":{"metadata":{"labels":{"app":"backend"}},"spec":{"containers":[{"env":[{"name":"APP_NAME","valueFrom":{"configMapKeyRef":{"key":"APP_NAME","name":"backend-config"}}},{"name":"APP_ENV","valueFrom":{"configMapKeyRef":{"key":"APP_ENV","name":"backend-config"}}},{"name":"DEBUG","valueFrom":{"configMapKeyRef":{"key":"DEBUG","name":"backend-config"}}},{"name":"LOG_LEVEL","valueFrom":{"configMapKeyRef":{"key":"LOG_LEVEL","name":"backend-config"}}},{"name":"API_PREFIX","valueFrom":{"configMapKeyRef":{"key":"API_PREFIX","name":"backend-config"}}},{"name":"CORS_ORIGINS","valueFrom":{"configMapKeyRef":{"key":"CORS_ORIGINS","name":"backend-config"}}},{"name":"IN_CLUSTER","valueFrom":{"configMapKeyRef":{"key":"IN_CLUSTER","name":"backend-config"}}},{"name":"KEYCLOAK_URL","valueFrom":{"configMapKeyRef":{"key":"KEYCLOAK_URL","name":"backend-config"}}},{"name":"KEYCLOAK_REALM","valueFrom":{"configMapKeyRef":{"key":"KEYCLOAK_REALM","name":"backend-config"}}},{"name":"KEYCLOAK_CLIENT_ID","valueFrom":{"configMapKeyRef":{"key":"KEYCLOAK_CLIENT_ID","name":"backend-config"}}},{"name":"DATABASE_URL","valueFrom":{"secretKeyRef":{"key":"DATABASE_URL","name":"backend-secret"}}},{"name":"KEYCLOAK_CLIENT_SECRET","valueFrom":{"secretKeyRef":{"key":"KEYCLOAK_CLIENT_SECRET","name":"backend-secret"}}},{"name":"KEYCLOAK_ADMIN_USERNAME","valueFrom":{"secretKeyRef":{"key":"KEYCLOAK_ADMIN_USERNAME","name":"backend-secret"}}},{"name":"KEYCLOAK_ADMIN_PASSWORD","valueFrom":{"secretKeyRef":{"key":"KEYCLOAK_ADMIN_PASSWORD","name":"backend-secret"}}}],"image":"122610483530.dkr.ecr.ap-south-1.amazonaws.com/tenant-management-backend:latest","imagePullPolicy":"Always","livenessProbe":{"httpGet":{"path":"/health","port":8000},"initialDelaySeconds":30,"periodSeconds":10,"timeoutSeconds":5},"name":"backend","ports":[{"containerPort":8000,"name":"http"},{"containerPort":9090,"name":"metrics"}],"readinessProbe":{"httpGet":{"path":"/health","port":8000},"initialDelaySeconds":10,"periodSeconds":5,"timeoutSeconds":3},"resources":{"limits":{"cpu":"500m","memory":"512Mi"},"requests":{"cpu":"250m","memory":"256Mi"}}}],"initContainers":[{"command":["sh","-c","until nc -z postgres-service 5432; do echo waiting for postgres; sleep 2; done;"],"image":"busybox:1.36","name":"wait-for-postgres"}],"serviceAccountName":"tenant-manager"}}}}
  creationTimestamp: "2026-01-01T13:17:07Z"
  generation: 47
  labels:
    app: backend
  name: backend
  namespace: tenant-management
  resourceVersion: "195719426"
  uid: d69d29ad-84e1-4c5a-940b-847ce66ef4f8
spec:
  progressDeadlineSeconds: 600
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: backend
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/restartedAt: "2026-01-06T21:35:17+05:30"
      creationTimestamp: null
      labels:
        app: backend
    spec:
      containers:
      - env:
        - name: APP_NAME
          valueFrom:
            configMapKeyRef:
              key: APP_NAME
              name: backend-config
        - name: APP_ENV
          valueFrom:
            configMapKeyRef:
              key: APP_ENV
              name: backend-config
        - name: DEBUG
          valueFrom:
            configMapKeyRef:
              key: DEBUG
              name: backend-config
        - name: LOG_LEVEL
          valueFrom:
            configMapKeyRef:
              key: LOG_LEVEL
              name: backend-config
        - name: API_PREFIX
          valueFrom:
            configMapKeyRef:
              key: API_PREFIX
              name: backend-config
        - name: CORS_ORIGINS
          valueFrom:
            configMapKeyRef:
              key: CORS_ORIGINS
              name: backend-config
        - name: IN_CLUSTER
          valueFrom:
            configMapKeyRef:
              key: IN_CLUSTER
              name: backend-config
        - name: KEYCLOAK_URL
          valueFrom:
            configMapKeyRef:
              key: KEYCLOAK_URL
              name: backend-config
        - name: KEYCLOAK_REALM
          valueFrom:
            configMapKeyRef:
              key: KEYCLOAK_REALM
              name: backend-config
        - name: KEYCLOAK_CLIENT_ID
          valueFrom:
            configMapKeyRef:
              key: KEYCLOAK_CLIENT_ID
              name: backend-config
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              key: DATABASE_URL
              name: backend-secret
        - name: KEYCLOAK_CLIENT_SECRET
          valueFrom:
            secretKeyRef:
              key: KEYCLOAK_CLIENT_SECRET
              name: backend-secret
        - name: KEYCLOAK_ADMIN_USERNAME
          valueFrom:
            secretKeyRef:
              key: KEYCLOAK_ADMIN_USERNAME
              name: backend-secret
        - name: KEYCLOAK_ADMIN_PASSWORD
          valueFrom:
            secretKeyRef:
              key: KEYCLOAK_ADMIN_PASSWORD
              name: backend-secret
        image: 122610483530.dkr.ecr.ap-south-1.amazonaws.com/tenant-management-backend:latest
        imagePullPolicy: Always
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /health
            port: 8000
            scheme: HTTP
          initialDelaySeconds: 30
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        name: backend
        ports:
        - containerPort: 8000
          name: http
          protocol: TCP
        - containerPort: 9090
          name: metrics
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /health
            port: 8000
            scheme: HTTP
          initialDelaySeconds: 10
          periodSeconds: 5
          successThreshold: 1
          timeoutSeconds: 3
        resources:
          limits:
            cpu: 500m
            memory: 512Mi
          requests:
            cpu: 250m
            memory: 256Mi
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      dnsPolicy: ClusterFirst
      initContainers:
      - command:
        - sh
        - -c
        - until nc -z postgres-service 5432; do echo waiting for postgres; sleep 2;
          done;
        image: busybox:1.36
        imagePullPolicy: IfNotPresent
        name: wait-for-postgres
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      serviceAccount: tenant-manager
      serviceAccountName: tenant-manager
      terminationGracePeriodSeconds: 30
status:
  availableReplicas: 1
  conditions:
  - lastTransitionTime: "2026-01-01T13:17:07Z"
    lastUpdateTime: "2026-01-06T16:05:37Z"
    message: ReplicaSet "backend-5fbbfd5d56" has successfully progressed.
    reason: NewReplicaSetAvailable
    status: "True"
    type: Progressing
  - lastTransitionTime: "2026-01-07T04:06:33Z"
    lastUpdateTime: "2026-01-07T04:06:33Z"
    message: Deployment has minimum availability.
    reason: MinimumReplicasAvailable
    status: "True"
    type: Available
  observedGeneration: 47
  readyReplicas: 1
  replicas: 1
  updatedReplicas: 1
